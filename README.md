# __Тестовое задание "Северсталь"__

## __Описание задания__
### Задание 2

Необходимо создать backend для работы со складом рулонов металла. Это задание нужно выполнить на Python.

__Рулон__: id, длина, вес, дата добавления, дата удаления.
Обязательные пункты:

1. RESTFull API:
   - a. добавление нового рулона на склад. Длина и вес — обязательные параметры. В случае успеха возвращает добавленный рулон;
   - b. удаление рулона с указанным id со склада. В случае успеха возвращает удалённый рулон;
   - c. получение списка рулонов со склада. Рассмотреть возможность фильтрации по одному из диапазонов единовременно (id/веса/длины/даты добавления/даты удаления со склада);
   - d. получение статистики по рулонам за определённый период:
        - количество добавленных рулонов;
        - количество удалённых рулонов;
        - средняя длина, вес рулонов, находившихся на складе в этот период;
        - максимальная и минимальная длина и вес рулонов, находившихся на складе в этот период;
        - суммарный вес рулонов на складе за период;
        - максимальный и минимальный промежуток между добавлением и удалением рулона.

2. Данные по рулонам должны храниться в базе данных (желательно
PostgreSQL/SQLite).

3. Должны быть обработаны стандартные кейсы ошибок (например, недоступна БД, не существует рулон при какой-то работе с ним).

4. Используемый стек: FastAPI, SQLAlchemy, pydantic (версии и до 2.0, и после 2.0 подойдут).

__Бонусные баллы__:

1. Получение списка рулонов с фильтрацией (п.1, с.) работает по комбинации нескольких диапазонов сразу.

2. Получение статистики по рулонам (п.1, d.) дополнительно возвращает:
    - день, когда на складе находилось минимальное и максимальное
количество рулонов за указанный период;
    - день, когда суммарный вес рулонов на складе был минимальным и максимальным в указанный период.

3. Проект должен быть обёрнут в Docker.

4. Конфигурации к подключению к БД должны быть настраиваемыми через файл или ENV.

5. Проект должен быть покрыт тестами.

6. Проект должен проходить mypy, flake8 и прочее.

7. Отсутствие глобальных переменных.

__Идеи для улучшения__:

1. Использование абстракций/интерфейсов для возможной замены транспорта. Например, с PostgreSQL на какое-нибудь хранилище (InMemory / Redis / File).

2. Тесты не должны зависеть от реальной базы данных (т.е. использовать класс,фальшивку или моки).

## __Сборка__
Для того, чтобы собрать приложение, необходимо склонировать любым удобным способом данный репозиторий.

Так же для удобства можно установить direnv, который может автоматизировать рутинные задачи, в противном случае enviroment переменные необходимо будет добавлять вручную с помощью export.

Если имеется Docker, то можно выполнить сборку приложения следуя следующим инструкциям:

- Перейти в корневую директорию с проектом.
- Для сбокри alembic выполнить:
        ``` docker buildx build --tag alembic-migrations:latest -f etc/Dockerfile.migrations . ```
- Для сборки приложения выполнить:
        ``` docker buildx build --tag warehouse:latest . ```
- После этого можно запустить контейнеры:
 ``` make start ``` - если запустить эту комманду в корневой директории проекта, то она запустит все контейнеры сразу.
 ``` make start-services SERVICES="database alembic-migrations application" ``` - этой командой можно запустить только нужные Вам контейнеры.
- После запуска перейти по адресу [localhost](http://localhost:8000/swagger-ui#/) p.s. ссылка будет работать если не меняли порт в dev.env.
 
 Для того чтобы остановить контейнеры необходимо прописать ``` make drop ```.

## __Используемые технологии__
- Python 3.12
- Fastapi
- Hatch
- Pydantic
- SQLAlchemy
- Uvicorn 
- Alembic
- PostgreSQL
- Docker